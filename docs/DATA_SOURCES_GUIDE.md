# A股数据源完整指南

## 📋 问题说明

当前使用akshare的`stock_zh_a_spot_em()`接口获取实时数据时，经常遇到连接中断问题，导致数据不完整（只有代码和名称，缺少价格、市值等）。

## 🎯 可用的数据源

### 1. Tushare（推荐⭐⭐⭐⭐⭐）

**优点**：
- 数据完整、准确、稳定
- 官方API，接口规范
- 支持批量获取，效率高
- 包含PE、PB、市值等完整数据

**获取方式**：
1. 访问 https://tushare.pro
2. 注册账号（免费）
3. 完成实名认证（免费版有调用限制）
4. 获取Token（在个人中心查看）

**配置方法**：
在`.env`文件中添加：
```bash
TUSHARE_TOKEN=your_token_here
TUSHARE_ENABLED=true
```

**费用**：
- 免费版：每日500次调用，积分制
- 积分版：¥500/年，更高调用限制
- 专业版：¥3000/年，无限制

**数据字段**：
- 股票代码、名称 ✓
- 最新价格 ✓
- 总市值、流通市值 ✓
- 市盈率(PE) ✓
- 市净率(PB) ✓
- 行业信息 ✓
- 更多财务指标 ✓

---

### 2. 东方财富（AKShare，当前使用）

**优点**：
- 免费、无需API key
- 数据来源官方
- 接口丰富

**缺点**：
- 连接不稳定（您当前遇到的问题）
- 可能被限流
- 大请求容易失败

**适用场景**：
- 作为备用数据源
- 当Tushare不可用时使用

---

### 3. 同花顺iFind

**获取方式**：
1. 访问 https://www.51ifind.com
2. 联系销售获取API授权
3. 需要企业认证

**费用**：
- 需要询价，通常较贵
- 适合机构用户

---

### 4. 万得Wind

**获取方式**：
1. 访问 https://www.wind.com.cn
2. 联系销售获取授权
3. 需要企业认证

**费用**：
- 较高（通常数万元/年）
- 适合专业机构

---

### 5. 聚宽JQData（量化平台）

**获取方式**：
1. 访问 https://www.joinquant.com
2. 注册账号
3. 申请JQData使用权限

**费用**：
- 有免费额度
- 付费版按量计费

---

### 6. 米筐RiceQuant

**获取方式**：
1. 访问 https://www.ricequant.com
2. 注册账号
3. 申请API使用权限

**费用**：
- 有免费额度
- 付费版按量计费

---

## 🚀 推荐解决方案

### 方案1：使用Tushare（最推荐）

**为什么推荐**：
1. **稳定可靠**：官方API，不会遇到连接中断问题
2. **数据完整**：包含所有需要的字段（PE、PB、市值等）
3. **性价比高**：免费版可以满足基础需求
4. **已集成**：系统已支持Tushare

**实施步骤**：
1. 注册Tushare账号并获取Token
2. 在`.env`文件中配置`TUSHARE_TOKEN`
3. 重新运行下载脚本，系统会自动使用Tushare

### 方案2：混合使用（Tushare + AKShare）

**策略**：
- 优先使用Tushare获取完整数据
- 如果Tushare不可用，降级到AKShare基础接口
- 确保至少能获取代码和名称

**系统已实现**：✅ 自动降级逻辑

---

## 📝 如何获取Tushare Token

### 步骤1：注册账号
1. 访问 https://tushare.pro
2. 点击"注册"
3. 填写邮箱和密码
4. 验证邮箱

### 步骤2：实名认证
1. 登录后进入"个人中心"
2. 点击"实名认证"
3. 上传身份证照片（正反面）
4. 等待审核（通常1-2小时）

### 步骤3：获取Token
1. 认证通过后，进入"接口TOKEN"
2. 点击"复制Token"
3. 将Token保存到`.env`文件

### 步骤4：配置系统
```bash
# 编辑 .env 文件
TUSHARE_TOKEN=你的token
TUSHARE_ENABLED=true
```

---

## 🔧 系统已实现的改进

1. **自动数据源切换**：
   - 优先使用Tushare（如果配置了Token）
   - 如果Tushare失败，自动降级到AKShare
   - 确保至少能获取基础信息

2. **降级方案**：
   - 如果实时数据接口失败，保存基础信息（代码+名称）
   - 避免完全失败

3. **多数据源支持**：
   - Tushare（首选）
   - AKShare（备用）
   - 可扩展其他数据源

---

## 💡 建议

1. **立即行动**：注册Tushare账号并获取Token（免费）
2. **配置Token**：添加到`.env`文件中
3. **重新下载**：运行下载脚本，系统会自动使用Tushare
4. **验证数据**：检查数据是否完整（包含价格、市值等）

---

## 📞 技术支持

如果遇到问题：
1. 查看系统日志了解具体错误
2. 检查`.env`文件配置是否正确
3. 验证Tushare Token是否有效
4. 查看`docs/TROUBLESHOOTING_A_SHARE_DOWNLOAD.md`获取更多帮助

