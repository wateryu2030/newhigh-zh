# é‡åŒ–äº¤æ˜“æ¨¡å‹è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

åŸºäºç°æœ‰çš„æŠ€æœ¯åˆ†æã€ä¿¡å·å¤„ç†å’Œå†³ç­–èƒ½åŠ›ï¼Œæ„å»ºå®Œæ•´çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼Œå®ç°è‡ªåŠ¨åŒ–äº¤æ˜“ç­–ç•¥æ‰§è¡Œå’Œé£é™©ç®¡ç†ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

1. **ä¿¡å·ç”Ÿæˆ**: åŸºäºæŠ€æœ¯æŒ‡æ ‡å’Œå¸‚åœºæ•°æ®ç”Ÿæˆä¹°å–ä¿¡å·
2. **ç­–ç•¥æ‰§è¡Œ**: è‡ªåŠ¨æ‰§è¡Œäº¤æ˜“ç­–ç•¥ï¼ŒåŒ…æ‹¬å¼€ä»“ã€å¹³ä»“ã€åŠ ä»“ã€å‡ä»“
3. **é£é™©ç®¡ç†**: æ­¢æŸã€æ­¢ç›ˆã€ä»“ä½ç®¡ç†ã€é£é™©æ§åˆ¶
4. **å›æµ‹éªŒè¯**: å†å²æ•°æ®å›æµ‹ï¼ŒéªŒè¯ç­–ç•¥æœ‰æ•ˆæ€§
5. **å®æ—¶ç›‘æ§**: æŒç»­ç›‘æ§æŒä»“å’Œå¸‚åœºå˜åŒ–

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 é‡åŒ–äº¤æ˜“ç³»ç»Ÿæ ¸å¿ƒå¼•æ“                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ç­–ç•¥ç®¡ç†å™¨ (Strategy Manager)                       â”‚
â”‚     â”œâ”€â”€ è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ (Trend Following)                  â”‚
â”‚     â”œâ”€â”€ å‡å€¼å›å½’ç­–ç•¥ (Mean Reversion)                   â”‚
â”‚     â”œâ”€â”€ åŠ¨é‡ç­–ç•¥ (Momentum)                              â”‚
â”‚     â”œâ”€â”€ å¥—åˆ©ç­–ç•¥ (Arbitrage)                             â”‚
â”‚     â””â”€â”€ è‡ªå®šä¹‰ç­–ç•¥ (Custom Strategies)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. ä¿¡å·ç”Ÿæˆå™¨ (Signal Generator)                       â”‚
â”‚     â”œâ”€â”€ æŠ€æœ¯æŒ‡æ ‡ä¿¡å·                                    â”‚
â”‚     â”‚   - RSIè¶…ä¹°è¶…å–ä¿¡å·                               â”‚
â”‚     â”‚   - MACDé‡‘å‰æ­»å‰ä¿¡å·                              â”‚
â”‚     â”‚   - å¸ƒæ—å¸¦çªç ´ä¿¡å·                                â”‚
â”‚     â”‚   - ç§»åŠ¨å¹³å‡çº¿äº¤å‰ä¿¡å·                            â”‚
â”‚     â”œâ”€â”€ åŸºæœ¬é¢ä¿¡å·                                       â”‚
â”‚     â”‚   - è´¢æŠ¥äº‹ä»¶ä¿¡å·                                  â”‚
â”‚     â”‚   - ä¼°å€¼å˜åŒ–ä¿¡å·                                  â”‚
â”‚     â”œâ”€â”€ æƒ…ç»ªä¿¡å·                                        â”‚
â”‚     â”‚   - ç¤¾äº¤åª’ä½“æƒ…ç»ªæç«¯å€¼ä¿¡å·                        â”‚
â”‚     â”‚   - æ–°é—»äº‹ä»¶ä¿¡å·                                  â”‚
â”‚     â””â”€â”€ ç»¼åˆä¿¡å·èåˆ                                    â”‚
â”‚         - å¤šä¿¡å·æŠ•ç¥¨æœºåˆ¶                                â”‚
â”‚         - ä¿¡å·å¼ºåº¦åŠ æƒ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. äº¤æ˜“æ‰§è¡Œå¼•æ“ (Trading Execution Engine)            â”‚
â”‚     â”œâ”€â”€ è®¢å•ç®¡ç†                                        â”‚
â”‚     â”‚   - é™ä»·å•/å¸‚ä»·å•                                 â”‚
â”‚     â”‚   - æ­¢æŸå•/æ­¢ç›ˆå•                                 â”‚
â”‚     â”‚   - æ¡ä»¶å•                                        â”‚
â”‚     â”œâ”€â”€ ä»“ä½ç®¡ç†                                        â”‚
â”‚     â”‚   - ä»“ä½è®¡ç®—                                      â”‚
â”‚     â”‚   - åˆ†æ‰¹å»ºä»“/å‡ä»“                                 â”‚
â”‚     â”‚   - ä»“ä½å¹³è¡¡                                      â”‚
â”‚     â””â”€â”€ äº¤æ˜“æ‰§è¡Œ                                        â”‚
â”‚         - æ¨¡æ‹Ÿäº¤æ˜“/å®ç›˜äº¤æ˜“                             â”‚
â”‚         - äº¤æ˜“è®°å½•                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. é£é™©ç®¡ç†æ¨¡å— (Risk Management Module)              â”‚
â”‚     â”œâ”€â”€ æ­¢æŸç®¡ç†                                        â”‚
â”‚     â”‚   - å›ºå®šæ­¢æŸ/ç§»åŠ¨æ­¢æŸ                             â”‚
â”‚     â”‚   - æ­¢æŸç™¾åˆ†æ¯”/ç‚¹æ•°æ­¢æŸ                            â”‚
â”‚     â”œâ”€â”€ æ­¢ç›ˆç®¡ç†                                        â”‚
â”‚     â”‚   - ç›®æ ‡æ­¢ç›ˆ/ç§»åŠ¨æ­¢ç›ˆ                             â”‚
â”‚     â”‚   - åˆ†æ‰¹æ­¢ç›ˆ                                      â”‚
â”‚     â”œâ”€â”€ ä»“ä½é™åˆ¶                                        â”‚
â”‚     â”‚   - å•è‚¡æœ€å¤§ä»“ä½                                  â”‚
â”‚     â”‚   - æ€»ä»“ä½é™åˆ¶                                    â”‚
â”‚     â”‚   - è¡Œä¸šé›†ä¸­åº¦é™åˆ¶                                â”‚
â”‚     â””â”€â”€ é£é™©ç›‘æ§                                        â”‚
â”‚         - å®æ—¶é£é™©æŒ‡æ ‡                                  â”‚
â”‚         - é£é™©é¢„è­¦                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. å›æµ‹å¼•æ“ (Backtesting Engine)                       â”‚
â”‚     â”œâ”€â”€ å†å²æ•°æ®åŠ è½½                                    â”‚
â”‚     â”œâ”€â”€ ç­–ç•¥æ¨¡æ‹Ÿæ‰§è¡Œ                                    â”‚
â”‚     â”œâ”€â”€ æ€§èƒ½è¯„ä¼°                                        â”‚
â”‚     â”‚   - æ”¶ç›Šç‡ã€å¤æ™®æ¯”ç‡                               â”‚
â”‚     â”‚   - æœ€å¤§å›æ’¤                                      â”‚
â”‚     â”‚   - èƒœç‡ã€ç›ˆäºæ¯”                                   â”‚
â”‚     â””â”€â”€ æŠ¥å‘Šç”Ÿæˆ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ç­–ç•¥ç±»å‹è¯¦è§£

### 1. è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥ (Trend Following)

#### ç­–ç•¥é€»è¾‘
```python
# åŒå‡çº¿ç­–ç•¥
if MA_short > MA_long and MA_short_yesterday <= MA_long_yesterday:
    signal = BUY  # é‡‘å‰ä¹°å…¥
elif MA_short < MA_long and MA_short_yesterday >= MA_long_yesterday:
    signal = SELL  # æ­»å‰å–å‡º
```

#### å…³é”®å‚æ•°
- **çŸ­æœŸå‡çº¿**: MA5, MA10
- **é•¿æœŸå‡çº¿**: MA20, MA30, MA60
- **è¶‹åŠ¿ç¡®è®¤**: éœ€è¦æŒç»­Nå¤©è¶‹åŠ¿ç¡®è®¤
- **æ­¢æŸ**: -5%å›ºå®šæ­¢æŸ
- **æ­¢ç›ˆ**: +15%ç›®æ ‡æ­¢ç›ˆ

### 2. å‡å€¼å›å½’ç­–ç•¥ (Mean Reversion)

#### ç­–ç•¥é€»è¾‘
```python
# å¸ƒæ—å¸¦ç­–ç•¥
if price < boll_lower and RSI < 30:
    signal = BUY  # ä»·æ ¼è§¦åŠä¸‹è½¨ä¸”è¶…å–
elif price > boll_upper and RSI > 70:
    signal = SELL  # ä»·æ ¼è§¦åŠä¸Šè½¨ä¸”è¶…ä¹°
```

#### å…³é”®å‚æ•°
- **å¸ƒæ—å¸¦å‘¨æœŸ**: 20æ—¥
- **æ ‡å‡†å·®å€æ•°**: 2å€
- **RSIé˜ˆå€¼**: 30/70
- **æ­¢æŸ**: -3%
- **æ­¢ç›ˆ**: +5%

### 3. åŠ¨é‡ç­–ç•¥ (Momentum)

#### ç­–ç•¥é€»è¾‘
```python
# RSI + MACDåŠ¨é‡ç­–ç•¥
momentum_score = (RSI_score + MACD_score) / 2

if momentum_score > 70 and volume_increase > 20%:
    signal = BUY  # å¼ºåŠ¨é‡ä¹°å…¥
elif momentum_score < 30:
    signal = SELL  # åŠ¨é‡è¡°ç«­å–å‡º
```

### 4. ç»¼åˆå¤šå› å­ç­–ç•¥ (Multi-Factor Strategy)

#### ç­–ç•¥é€»è¾‘
```python
# æ•´åˆç°æœ‰åˆ†æå¸ˆçš„å»ºè®®
factors = {
    'technical': market_analyst_score,      # æŠ€æœ¯é¢è¯„åˆ†
    'fundamental': fundamentals_score,       # åŸºæœ¬é¢è¯„åˆ†
    'sentiment': sentiment_score,            # æƒ…ç»ªè¯„åˆ†
    'news': news_event_score                 # æ–°é—»äº‹ä»¶è¯„åˆ†
}

# åŠ æƒç»¼åˆè¯„åˆ†
composite_score = weighted_sum(factors, weights)

if composite_score > buy_threshold:
    signal = BUY
elif composite_score < sell_threshold:
    signal = SELL
```

## âš™ï¸ é£é™©ç®¡ç†è§„åˆ™

### 1. æ­¢æŸè§„åˆ™

#### å›ºå®šæ­¢æŸ
```python
stop_loss_price = entry_price * (1 - stop_loss_percent)
# ä¾‹å¦‚: ä¹°å…¥ä»·10å…ƒï¼Œæ­¢æŸ5% = 9.5å…ƒ
```

#### ç§»åŠ¨æ­¢æŸï¼ˆTrailing Stopï¼‰
```python
# ä»·æ ¼ä¸Šæ¶¨æ—¶ï¼Œæ­¢æŸä»·æ ¼è·Ÿéšä¸Šç§»
if current_price > highest_price:
    highest_price = current_price
    stop_loss_price = highest_price * (1 - trailing_stop_percent)
```

### 2. æ­¢ç›ˆè§„åˆ™

#### ç›®æ ‡æ­¢ç›ˆ
```python
take_profit_price = entry_price * (1 + take_profit_percent)
# ä¾‹å¦‚: ä¹°å…¥ä»·10å…ƒï¼Œæ­¢ç›ˆ15% = 11.5å…ƒ
```

#### åˆ†æ‰¹æ­¢ç›ˆ
```python
# ä»·æ ¼ä¸Šæ¶¨åˆ°ä¸åŒç›®æ ‡ä½ï¼Œåˆ†æ‰¹å–å‡º
if current_price >= entry_price * 1.10:
    sell_position(30%)  # æ­¢ç›ˆ30%ä»“ä½
if current_price >= entry_price * 1.20:
    sell_position(30%)  # å†æ­¢ç›ˆ30%ä»“ä½
if current_price >= entry_price * 1.30:
    sell_position(40%)  # æœ€åæ­¢ç›ˆ40%ä»“ä½
```

### 3. ä»“ä½ç®¡ç†

#### å‡¯åˆ©å…¬å¼ (Kelly Criterion)
```python
# è®¡ç®—æœ€ä¼˜ä»“ä½
kelly_fraction = (win_rate * (avg_win / avg_loss) - (1 - win_rate)) / (avg_win / avg_loss)
position_size = kelly_fraction * total_capital

# é™åˆ¶æœ€å¤§ä»“ä½ï¼ˆä¾‹å¦‚ä¸è¶…è¿‡25%ï¼‰
position_size = min(position_size, total_capital * 0.25)
```

#### ç­‰æƒé‡åˆ†é…
```python
# Nåªè‚¡ç¥¨å¹³å‡åˆ†é…
position_size_per_stock = total_capital / N
```

#### é£é™©å¹³ä»· (Risk Parity)
```python
# æ ¹æ®æ³¢åŠ¨ç‡åˆ†é…ä»“ä½ï¼Œä½¿æ¯åªè‚¡ç¥¨è´¡çŒ®ç›¸åŒé£é™©
risk_contribution = position_size * volatility
target_risk = total_capital * target_risk_per_stock
position_size = target_risk / volatility
```

## ğŸ“ˆ å›æµ‹æ¡†æ¶

### å›æµ‹æµç¨‹
```python
def backtest(strategy, start_date, end_date, initial_capital):
    """
    ç­–ç•¥å›æµ‹ä¸»å‡½æ•°
    """
    # 1. åŠ è½½å†å²æ•°æ®
    data = load_historical_data(start_date, end_date)
    
    # 2. åˆå§‹åŒ–
    portfolio = Portfolio(initial_capital)
    positions = {}
    
    # 3. é€æ—¥å›æµ‹
    for date in data.index:
        # è®¡ç®—ä¿¡å·
        signals = strategy.generate_signals(data, date)
        
        # æ‰§è¡Œäº¤æ˜“
        execute_trades(signals, portfolio, positions, date)
        
        # æ›´æ–°æŒä»“ä»·å€¼
        update_positions_value(positions, data, date)
        
        # é£é™©ç®¡ç†
        check_stop_loss_take_profit(positions, data, date)
    
    # 4. è®¡ç®—ç»©æ•ˆæŒ‡æ ‡
    performance = calculate_performance(portfolio, data)
    
    return performance
```

### ç»©æ•ˆæŒ‡æ ‡

```python
# æ”¶ç›Šç‡æŒ‡æ ‡
total_return = (final_value - initial_value) / initial_value
annual_return = (1 + total_return) ** (252 / trading_days) - 1

# é£é™©æŒ‡æ ‡
sharpe_ratio = annual_return / annual_volatility
max_drawdown = max((peak - trough) / peak)

# äº¤æ˜“æŒ‡æ ‡
win_rate = winning_trades / total_trades
profit_factor = total_profits / abs(total_losses)
average_win = total_profits / winning_trades
average_loss = total_losses / losing_trades
```

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. æ•°æ®å‡†å¤‡
- å¤ç”¨ç°æœ‰çš„ `get_stock_market_data_unified` è·å–å†å²æ•°æ®
- åˆ©ç”¨æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å·¥å…·ç”Ÿæˆäº¤æ˜“ä¿¡å·

### 2. ä¿¡å·ç”Ÿæˆ
- æ•´åˆç°æœ‰åˆ†æå¸ˆæŠ¥å‘Šä¸­çš„æŠ•èµ„å»ºè®®
- ä½¿ç”¨ `SignalProcessor` è§£æäº¤æ˜“ä¿¡å·
- å¤šä¿¡å·èåˆï¼Œæé«˜å‡†ç¡®æ€§

### 3. æ¨¡æ‹Ÿäº¤æ˜“
- åœ¨å®ç›˜äº¤æ˜“å‰ï¼Œå…ˆè¿›è¡Œæ¨¡æ‹Ÿäº¤æ˜“
- è®°å½•æ¯ç¬”äº¤æ˜“ï¼Œåˆ†æäº¤æ˜“é€»è¾‘

### 4. å®æ—¶ç›‘æ§
- å®šæ—¶æ£€æŸ¥æŒä»“çŠ¶æ€
- è§¦å‘æ­¢æŸæ­¢ç›ˆæ¡ä»¶æ—¶è‡ªåŠ¨æ‰§è¡Œ

## ğŸ“Š ç­–ç•¥é…ç½®ç¤ºä¾‹

### ä¿å®ˆå‹ç­–ç•¥
```python
conservative_strategy = {
    'name': 'ä¿å®ˆè¶‹åŠ¿è·Ÿè¸ª',
    'indicators': ['MA5', 'MA20'],
    'entry_condition': 'MA5 > MA20 and volume > avg_volume*1.5',
    'exit_condition': 'MA5 < MA20',
    'stop_loss': -3.0,        # -3%æ­¢æŸ
    'take_profit': +10.0,     # +10%æ­¢ç›ˆ
    'position_size': 0.10,    # å•è‚¡æœ€å¤§10%ä»“ä½
    'max_positions': 5        # æœ€å¤š5åªè‚¡ç¥¨
}
```

### æ¿€è¿›å‹ç­–ç•¥
```python
aggressive_strategy = {
    'name': 'æ¿€è¿›åŠ¨é‡ç­–ç•¥',
    'indicators': ['RSI', 'MACD', 'Volume'],
    'entry_condition': 'RSI > 60 and MACD > 0 and volume_surge',
    'exit_condition': 'RSI < 50 or MACD < 0',
    'stop_loss': -5.0,        # -5%æ­¢æŸ
    'take_profit': +20.0,     # +20%æ­¢ç›ˆ
    'position_size': 0.20,    # å•è‚¡æœ€å¤§20%ä»“ä½
    'max_positions': 10        # æœ€å¤š10åªè‚¡ç¥¨
}
```

## ğŸš€ æœªæ¥æ‰©å±•

1. **æœºå™¨å­¦ä¹ ç­–ç•¥**: ä½¿ç”¨æ·±åº¦å­¦ä¹ é¢„æµ‹ä»·æ ¼èµ°åŠ¿
2. **é«˜é¢‘äº¤æ˜“**: æ¯«ç§’çº§ä¿¡å·ç”Ÿæˆå’Œæ‰§è¡Œ
3. **æœŸæƒç­–ç•¥**: æ”¯æŒæœŸæƒäº¤æ˜“å’Œå¯¹å†²ç­–ç•¥
4. **ç»„åˆä¼˜åŒ–**: å¤šç­–ç•¥ç»„åˆï¼Œåˆ†æ•£é£é™©
5. **å®ç›˜å¯¹æ¥**: å¯¹æ¥åˆ¸å•†APIï¼Œå®ç°è‡ªåŠ¨åŒ–å®ç›˜äº¤æ˜“
